<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>密码学（5）：密码学中的公私钥</title>
    <link href="/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%885%EF%BC%89%EF%BC%9A%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%85%AC%E7%A7%81%E9%92%A5/"/>
    <url>/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%885%EF%BC%89%EF%BC%9A%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%85%AC%E7%A7%81%E9%92%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="叨两句"><a href="#叨两句" class="headerlink" title="叨两句"></a>叨两句</h2><p>密码系列文章，是对接第三方接口时接触到加解密，但是知识体系较乱。希望能整理常见证书、密钥、加解密方式这方面知识，用于简单理解和快速区分。<br>有些缺漏和待补充，后续慢慢完善。有任何问题欢迎提出，便于及时修正</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>⭐️在阅读本文前，请注意，本文中出现的词汇：证书&#x3D;公钥，密钥用于指代一对公钥和私钥。<br>⭐️在加解密和加验签中，私钥仅己方保存一份，公钥颁发出去可能给多个人保存。<br>⭐️一般证书（公钥）用于加密，私钥用于加签，因为签名需要不可伪造，具有唯一性。<br>⭐️本文按照个人习惯，整理了下常见的公私钥格式</p></blockquote><p>有任何问题欢迎提出，便于及时修正</p><h2 id="1、公私钥的文件编码格式"><a href="#1、公私钥的文件编码格式" class="headerlink" title="1、公私钥的文件编码格式"></a>1、公私钥的文件编码格式</h2><blockquote><p>💡核心数据类似于UTF-8、GBK的关系，只不过pem格式会在der外多加一层约定的文字。<br>💡常见的公私钥后缀：.pem .der .cer .crt .pfx .p12 .jks。<br>💡证书后缀与文件编码内容不一定一致</p></blockquote><h3 id="1-1-DER格式"><a href="#1-1-DER格式" class="headerlink" title="1.1 DER格式"></a>1.1 DER格式</h3><ul><li>内容格式：<strong>二进制</strong>表示数据</li><li>存储类型：仅限证书</li><li>文件后缀：der、cer、crt这几种通常都是DER</li><li>内容例子：打开都是二进制乱码，或者因为是二进制而无法正常打开</li></ul><h3 id="1-2-PEM格式"><a href="#1-2-PEM格式" class="headerlink" title="1.2 PEM格式"></a>1.2 PEM格式</h3><ul><li><p>内容格式：把二进制内容转换成ASCII码。含标准开头与结尾，中间为<strong>base64</strong>后的文字。</p></li><li><p>存储类型：证书或私钥</p></li><li><p>文件后缀： pem</p></li><li><p>内容例子：<br>  PEM实际上就是把DER编码的文件的二进制内容用base64编码一下，然后加上<br><code>-----BEGIN label-----</code> 和 <code>-----END label-----</code><br>  这样的头尾，中间则是DER文件的Base64编码。例如:</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">-----</span><span class="hljs-comment">BEGIN label</span><span class="hljs-literal">-----</span><br><span class="hljs-comment">BASE64Encoded</span><br><span class="hljs-literal">-----</span><span class="hljs-comment">END label</span><span class="hljs-literal">-----</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="2、公私钥的数据结构编码格式"><a href="#2、公私钥的数据结构编码格式" class="headerlink" title="2、公私钥的数据结构编码格式"></a>2、公私钥的数据结构编码格式</h2><blockquote><p>使用的加密标准，例如X.509标准 和 PKCS(公钥加密标准)系列(PKCS#1、PKCS#8、PKCS#12)<br>xx格式证书&#x2F;密钥一般指符合该标准格式的证书&#x2F;密钥</p></blockquote><h3 id="2-1-X-509格式证书"><a href="#2-1-X-509格式证书" class="headerlink" title="2.1 X.509格式证书"></a>2.1 X.509格式证书</h3><ul><li>名称：X.509是密码学里公钥证书的格式标准</li><li>仅含证书。X.509证书里含有公钥、身份信息（比如网络主机名，组织的名称或个体名称等）和签名信息（可以是证书签发机构CA的签名，也可以是自签名）。</li></ul><h3 id="2-1-PKCS-1格式"><a href="#2-1-PKCS-1格式" class="headerlink" title="2.1 PKCS#1格式"></a>2.1 PKCS#1格式</h3><ul><li><p>名称：RSA Cryptography Standard，RSA密码学标准。</p></li><li><p>可以含公钥，也可以含私钥。没有版本或算法标识符。介绍了RSA算法的计算过程，包括：key的产生，key的结构（RSA Public Key和Private Key数学属性和格式），对数字加密／解密／签名／验证签名的过程、对应算法。</p></li><li><p>用途：主要针对<strong>RSA算法的加解密、加验签</strong>。</p></li><li><p>拓展：PKCS1填充模式</p></li></ul><h4 id="公钥例子"><a href="#公钥例子" class="headerlink" title="公钥例子"></a>公钥例子</h4><p>一个PKCS#1公钥，以以下标签开头和结尾：</p><blockquote><p>  —–BEGIN RSA PUBLIC KEY—–<br>   BASE64 ENCODED DATA<br>   —–END RSA PUBLIC KEY—–</p></blockquote><p>在base64编码数据中，存在以下ASN.1语法结构（<a href="https://datatracker.ietf.org/doc/html/rfc8017#appendix-A.1.1">RFC8017 A.1.1</a>）：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RSAPublicKey ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>    modulus           <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- n</span><br>    publicExponent    <span class="hljs-type">INTEGER</span>   <span class="hljs-comment">-- e</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>注：<em>RFC8017废弃了RFC3447</em></p><h4 id="私钥例子"><a href="#私钥例子" class="headerlink" title="私钥例子"></a>私钥例子</h4><p> 一个PKCS#1的私钥，以以下标签开头和结尾：</p><blockquote><p>   —–BEGIN RSA PRIVATE KEY—–<br>    BASE64 ENCODED DATA<br>    —–END RSA PRIVATE KEY—–</p></blockquote><p>在base64编码数据中，存在以下ASN.1语法结构（<a href="https://datatracker.ietf.org/doc/html/rfc8017#appendix-A.1">RFC8017 A.1.2</a>）：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RSAPrivateKey ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>    <span class="hljs-keyword">version</span>           <span class="hljs-keyword">Version</span>,<br>    modulus           <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- n</span><br>    publicExponent    <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- e</span><br>    privateExponent   <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- d</span><br>    prime1            <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- p</span><br>    prime2            <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- q</span><br>    exponent1         <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- d mod (p-1)</span><br>    exponent2         <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- d mod (q-1)</span><br>    coefficient       <span class="hljs-type">INTEGER</span>,  <span class="hljs-comment">-- (inverse of q) mod p</span><br>    otherPrimeInfos   OtherPrimeInfos OPTIONAL<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-PKCS-8格式"><a href="#2-2-PKCS-8格式" class="headerlink" title="2.2 PKCS#8格式"></a>2.2 PKCS#8格式</h3><ul><li>名称：Private-Key Information Syntax Specification，私钥信息格式规范。</li><li>可以含公钥，也可以含私钥</li></ul><h4 id="公钥例子-1"><a href="#公钥例子-1" class="headerlink" title="公钥例子"></a>公钥例子</h4><blockquote><p>—–BEGIN PUBLIC KEY—–<br>BASE64 ENCODED DATA<br>—–END PUBLIC KEY—–</p></blockquote><p>在 base64 编码数据中，存在以下结构，ASN.1语法描述为：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">PublicKeyInfo ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>  algorithm       AlgorithmIdentifier,<br>  PublicKey       <span class="hljs-type">BIT</span> STRING<br>&#125;<br><br>AlgorithmIdentifier ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>  algorithm       <span class="hljs-keyword">OBJECT</span> IDENTIFIER,<br>  parameters      <span class="hljs-keyword">ANY</span> DEFINED <span class="hljs-keyword">BY</span> algorithm OPTIONAL<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="未加密的私钥例子"><a href="#未加密的私钥例子" class="headerlink" title="未加密的私钥例子"></a>未加密的私钥例子</h4><p>  未加密的 PKCS#8 编码数据格式如下：</p><blockquote><p>   —–BEGIN PRIVATE KEY—–<br>    BASE64 ENCODED DATA<br>    —–END PRIVATE KEY—–</p></blockquote><p>  在 base64 编码数据中，存在以下结构，ASN.1语法描述为：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">PrivateKeyInfo ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>    <span class="hljs-keyword">version</span>         <span class="hljs-keyword">Version</span>,<br>      algorithm       AlgorithmIdentifier,<br>      PrivateKey      <span class="hljs-type">BIT</span> STRING<br>    &#125;<br>AlgorithmIdentifier ::= <span class="hljs-keyword">SEQUENCE</span> &#123;<br>  algorithm       <span class="hljs-keyword">OBJECT</span> IDENTIFIER,<br>  parameters      <span class="hljs-keyword">ANY</span> DEFINED <span class="hljs-keyword">BY</span> algorithm OPTIONAL<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="加密的私钥例子"><a href="#加密的私钥例子" class="headerlink" title="加密的私钥例子"></a>加密的私钥例子</h4><p>加密的PKCS#8 编码数据格式如下：</p><blockquote><p>—–BEGIN ENCRYPTED PRIVATE KEY—–<br>BASE64Encoded<br>—–END ENCRYPTED PRIVATE KEY—–</p></blockquote><p>在 base64 编码数据中，存在以下结构，ASN.1语法描述为：</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bnf">EncryptedPrivateKeyInfo ::= SEQUENCE &#123;<br>  encryptionAlgorithm  EncryptionAlgorithmIdentifier,<br>  encryptedData        EncryptedData<br>&#125;<br><br>EncryptionAlgorithmIdentifier ::= AlgorithmIdentifier<br><br>EncryptedData ::= OCTET STRING<br></code></pre></td></tr></table></figure><h3 id="2-3-PKCS-12格式"><a href="#2-3-PKCS-12格式" class="headerlink" title="2.3 PKCS#12格式"></a>2.3 PKCS#12格式</h3><ul><li>名称：个人消息交换与打包语法</li><li>定义了通常用来存储Private Keys和Public Key Certificates（例如前面提到的X.509）的文件格式，使用基于密码的对称密钥进行保护。PKCS #12文件实际上是一个Keystore，PKCS #12文件可以被用做Java Key Store（JKS）。</li><li>文件后缀：一般为 .p12 或 .pfx</li><li></li></ul><h2 id="3、拓展"><a href="#3、拓展" class="headerlink" title="3、拓展"></a>3、拓展</h2><h3 id="3-1-ASN-1"><a href="#3-1-ASN-1" class="headerlink" title="3.1 ASN.1"></a>3.1 ASN.1</h3><p>ASN.1是一种用来定义数据结构的描述语言，有点类似于学习数据结构时用的伪代码。</p><h2 id="引用和参考"><a href="#引用和参考" class="headerlink" title="引用和参考"></a>引用和参考</h2><p><a href="https://chanjarster.github.io/post/x509-pkcs-file-formats/">https://chanjarster.github.io/post/x509-pkcs-file-formats/</a><br><a href="https://blog.ndpar.com/2017/04/17/p1-p8/">https://blog.ndpar.com/2017/04/17/p1-p8/</a><br><a href="https://www.jianshu.com/p/a428e183e72e">https://www.jianshu.com/p/a428e183e72e</a><br><a href="https://www.jianshu.com/p/bc32cbfe49e7">https://www.jianshu.com/p/bc32cbfe49e7</a><br><a href="https://blog.csdn.net/itworld123/article/details/115553346">https://blog.csdn.net/itworld123/article/details/115553346</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>密码学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码学（4）：常见非对称加密算法</title>
    <link href="/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%884%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    <url>/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%884%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="叨两句"><a href="#叨两句" class="headerlink" title="叨两句"></a>叨两句</h2><p>密码系列文章，是对接第三方接口时接触到加解密，但是知识体系较乱。希望能整理常见证书、密钥、加解密方式这方面知识，用于简单理解和快速区分。<br>有些缺漏和待补充，后续慢慢完善。有任何问题欢迎提出，便于及时修正</p><h2 id="1-RSA算法"><a href="#1-RSA算法" class="headerlink" title="1.RSA算法"></a>1.RSA算法</h2><h3 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h3><h3 id="2-依赖的数学原理"><a href="#2-依赖的数学原理" class="headerlink" title="2.依赖的数学原理"></a>2.依赖的数学原理</h3><p>1）将两个大 <strong>素数</strong> 相乘十分容易，但想要对其乘积进行 <strong>因式分解</strong> 却极其困难，因此可以将 <strong>乘积</strong> 公开作为 <strong>加密密钥</strong><br>2）具体原理可参考以下阮一峰老师的两篇文章：<br><a href="https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSA算法原理（一）</a><br><a href="https://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSA算法原理（二）</a></p><h3 id="3-处理方式：两种"><a href="#3-处理方式：两种" class="headerlink" title="3.处理方式：两种"></a>3.处理方式：两种</h3><pre><code class="hljs">1、分块加密：过长的明文，RSA不便处理，则按照密钥的长度，将原文分成一个个的数据块，依次进行RSA加密处理，得到加密数据。当有数据块不足要求长度时，则需要对块进行填充数据。填充方式有好几种，参考密码学分块加密的填充方式。2、先对</code></pre><h3 id="4-用途"><a href="#4-用途" class="headerlink" title="4.用途"></a>4.用途</h3><pre><code class="hljs">1、加密2、数字签名</code></pre><h3 id="5-相关在线工具"><a href="#5-相关在线工具" class="headerlink" title="5.相关在线工具"></a>5.相关在线工具</h3><p>1、生成密钥对：todo<br>2、加密生成与校验：todo<br>3、加签生成与校验：todo</p><h2 id="2-CMS信封算法"><a href="#2-CMS信封算法" class="headerlink" title="2.CMS信封算法"></a>2.CMS信封算法</h2><h2 id="3-SM2新国密算法"><a href="#3-SM2新国密算法" class="headerlink" title="3.SM2新国密算法"></a>3.SM2新国密算法</h2>]]></content>
    
    
    
    <tags>
      
      <tag>密码学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码学（3）：常见对称算法</title>
    <link href="/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%883%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E5%AF%B9%E7%A7%B0%E7%AE%97%E6%B3%95/"/>
    <url>/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%883%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E5%AF%B9%E7%A7%B0%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="叨两句"><a href="#叨两句" class="headerlink" title="叨两句"></a>叨两句</h2><p>密码系列文章，是对接第三方接口时接触到加解密，但是知识体系较乱。希望能整理常见证书、密钥、加解密方式这方面知识，用于简单理解和快速区分。<br>有些缺漏和待补充，后续慢慢完善。有任何问题欢迎提出，便于及时修正</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>块加密（分组加密）：加密算法无法一次性处理过长的明文，这种情况下，将明文以密钥长度分割，分成一个个固定长度的数据组（块），分别进行加密然后组合，该方式即为块加密，也称分组加密。</p><h2 id="1-AES算法"><a href="#1-AES算法" class="headerlink" title="1. AES算法"></a>1. AES算法</h2><pre><code class="hljs">分组密码AES 本身就是为了取代 DES 的，AES 具有更好的 安全性、效率 和 灵活性    根据算法密钥长度区分，有AES128、AES192、AES256等方式</code></pre><h2 id="2-DES算法"><a href="#2-DES算法" class="headerlink" title="2. DES算法"></a>2. DES算法</h2><pre><code class="hljs">待补充</code></pre><h2 id="3-3DES算法"><a href="#3-3DES算法" class="headerlink" title="3. 3DES算法"></a>3. 3DES算法</h2><pre><code class="hljs">基于 DES 的 对称算法，对 一块数据 用 三个不同的密钥 进行 三次加密，强度更高。</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>密码学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码学（2）：常见哈希算法</title>
    <link href="/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%882%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/"/>
    <url>/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%882%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="叨两句"><a href="#叨两句" class="headerlink" title="叨两句"></a>叨两句</h2><p>密码系列文章，是对接第三方接口时接触到加解密，但是知识体系较乱。希望能整理常见证书、密钥、加解密方式这方面知识，用于简单理解和快速区分。<br>有些缺漏和待补充，后续慢慢完善。有任何问题欢迎提出，便于及时修正</p><h2 id="1-MD5算法"><a href="#1-MD5算法" class="headerlink" title="1.MD5算法"></a>1.MD5算法</h2><pre><code class="hljs">1. 说明    杂凑算法之一2.格式    输入：不定长度信息    输出：固定长度128-bits3.安全与使用    安全性：不再适合当前的安全环境。    使用：广泛应用于错误检查。</code></pre><h2 id="2-SHA-1算法（sha1）"><a href="#2-SHA-1算法（sha1）" class="headerlink" title="2.SHA-1算法（sha1）"></a>2.SHA-1算法（sha1）</h2><pre><code class="hljs">1.说明    杂凑算法之一2.格式    输入：不定长度信息    输出：固定长度128-bits3.安全与使用    安全性：逐渐落后    使用：逐渐趋向现在和md5一样的用途</code></pre><h2 id="3-SHA-256算法（sha256）"><a href="#3-SHA-256算法（sha256）" class="headerlink" title="3.SHA-256算法（sha256）"></a>3.SHA-256算法（sha256）</h2><pre><code class="hljs">1.说明    杂凑算法之一2.格式    输入：不定长度信息    输出：固定长度128-bits的算法</code></pre><h2 id="4-RSA-SHA1算法"><a href="#4-RSA-SHA1算法" class="headerlink" title="4.RSA-SHA1算法"></a>4.RSA-SHA1算法</h2><pre><code class="hljs">1.说明    又称sha1WithRSAEncryption2.格式    输入：不定长度信息    输出：固定长度128-bits的算法</code></pre><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>1、<a href="https://zhuanlan.zhihu.com/p/101390996">https://zhuanlan.zhihu.com/p/101390996</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>密码学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>密码学（1）：常见算法分类</title>
    <link href="/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%881%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E5%88%86%E7%B1%BB/"/>
    <url>/2024/08/14/%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%881%EF%BC%89%EF%BC%9A%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<h2 id="叨两句"><a href="#叨两句" class="headerlink" title="叨两句"></a>叨两句</h2><p>密码系列文章，是对接第三方接口时接触到加解密，但是知识体系较乱。希望能整理常见证书、密钥、加解密方式这方面知识，用于简单理解和快速区分。<br>有些缺漏和待补充，后续慢慢完善。有任何问题欢迎提出，便于及时修正</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在需要对数据进行加解密或者加验签时，第一步要做的是确认所用的算法。<br>按照算法的处理方式（除了那些自定义的方式），主要可以分为：摘要算法、对称加密算法、非对称加密算法。</p><blockquote><p>算法使用场景例子：<br>A和B之间私密通话，但是有窃听者C。</p><p>1、明文通话：AB的信息可以轻易被C获取、修改和伪装。<br>2、对称加密通话：AB用同一密钥加解密，只要密钥不泄露，就是安全的。如果泄露了，因为有了密钥，数据很好伪装，和明文通话一样。<br>3、非对称加密通话：</p><ul><li>1）A生成一对公私钥，发公钥给B。B也生成一对公私钥，发公钥给A。公钥在这个过程中可以分发给更多人使用，私钥仅生成方保留。</li><li>2）发信息时，用对方的公钥加密，再用自己的私钥对加密数据进行签名，发送信息。</li><li>3）接收消息时，用对方的公钥验证签名（确保消息的来源方是对的），再用自己的私钥解密信息。<br>4、摘要+非对称加密通话：在加密后的信息过大时，因为签名算法十分复杂，直接对加密结果签名很耗时耗力。所以先加密，中间再对加密信息进行摘要，再对摘要结果进行签名。</li></ul></blockquote><h2 id="1-哈希算法（散列算法、摘要算法）"><a href="#1-哈希算法（散列算法、摘要算法）" class="headerlink" title="1.哈希算法（散列算法、摘要算法）"></a>1.哈希算法（散列算法、摘要算法）</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h3><pre><code class="hljs">1. Hash算法，翻译为散列算法，音译为哈希算法，也称摘要算法。2. 用来对任意一组输入数据进行处理，得到一个固定长度摘要的输出。相同的哈希算法，相同的输入会得到相同结果，不同的输入大概率会得到不同结果。3. 用途：是单向的算法，只能对信息进行加密，却无法解密。一般用于确认数据完整性和防止篡改，例如签名验证、完整性校验、密码存储等。</code></pre><h3 id="2-常见类型"><a href="#2-常见类型" class="headerlink" title="2.常见类型"></a>2.常见类型</h3><table><thead><tr><th>算法</th><th>输出长度（位）</th><th>输出长度（字节）</th><th>分组长度（位）</th></tr></thead><tbody><tr><td>MD5</td><td>128  bit</td><td>16 bytes</td><td></td></tr><tr><td>SHA-1</td><td>160  bit</td><td>20 bytes</td><td></td></tr><tr><td>RipeMD-160</td><td>160  bit</td><td>20 bytes</td><td></td></tr><tr><td>SHA-256</td><td>256  bit</td><td>32 bytes</td><td></td></tr><tr><td>SHA-512</td><td>512  bit</td><td>64 bytes</td><td></td></tr><tr><td>SM3(杂凑算法)</td><td>256  bit</td><td>32 bytes</td><td>512 bit</td></tr><tr><td>sha1WithRSAEncryption</td><td></td><td></td><td></td></tr></tbody></table><p>SHA-1 、SHA-256等一般也经常简写为sha1、sha256<br>sha1WithRSAEncryption &#x3D; RSA-SHA1</p><h3 id="3-常见问题：碰撞"><a href="#3-常见问题：碰撞" class="headerlink" title="3.常见问题：碰撞"></a>3.常见问题：碰撞</h3><ol><li>碰撞。因为摘要本质是将不定集映射到固定长度的有限集合，所以难免会出现不同输入得到相同输出，这个现象就是碰撞。可见，哈希算法输出长度越长，碰撞概率越低。</li><li>彩虹表破解。<br> 1）因为相同输入对应结果是相同的，可以暴力穷举破解，但是该方法耗时耗力。<br> 2）假设有一张表，存放了常见口令与对应哈希值。如果原始明文是常见口令，很容易通过比对彩虹表哈希值和摘要内容，得到原始信息，这个表就是彩虹表。<br> 3）因此，在用于存放密码哈希值时，可以对原密码加盐，即原密码再加上一串随机数，再对这个值进行哈希，就可以避免用户的常见口令被轻易破解。</li></ol><h2 id="2-对称加密算法"><a href="#2-对称加密算法" class="headerlink" title="2.对称加密算法"></a>2.对称加密算法</h2><h3 id="1-概念-1"><a href="#1-概念-1" class="headerlink" title="1.概念"></a>1.概念</h3><pre><code class="hljs">1. 当某一算法加解密使用的是同一密钥时，则为对称加密算法。2. 加解密过程是可逆的。需要加解密的人都有同一密钥，所以其中任一使用者的泄露都会导致安全隐患。3.用途：因为双发密钥一致，一般用于加密。如果用于签名时，因为双方密钥一致，无法区分，如果一定要用于签名，独有性的部分要靠其他的算法。</code></pre><blockquote><p>💡块加密（分组加密）：加密算法无法一次性处理过长的明文，这种情况下，将明文以密钥长度分割，分成一个个固定长度的数据组（块），分别进行加密然后组合，该方式即为块加密，也称分组加密。</p></blockquote><h3 id="2-常见类型-1"><a href="#2-常见类型-1" class="headerlink" title="2.常见类型"></a>2.常见类型</h3><table><thead><tr><th>算法</th><th>输出长度（位）</th><th>输出长度（字节）</th><th>分组（密钥）长度</th></tr></thead><tbody><tr><td>AES</td><td>128 bit</td><td>16 bytes</td><td></td></tr><tr><td>DES</td><td>160 bit</td><td>20 bytes</td><td>56 bit</td></tr><tr><td>3DES</td><td>160 bit</td><td>20 bytes</td><td></td></tr><tr><td>SM1（分组加密）</td><td>512 bit</td><td>64 bytes</td><td>128 bit</td></tr><tr><td>SM4（分组加密）</td><td>512 bit</td><td>64 bytes</td><td>128 bit</td></tr></tbody></table><h3 id="3-常见问题"><a href="#3-常见问题" class="headerlink" title="3.常见问题"></a>3.常见问题</h3><h2 id="3-非对称算法"><a href="#3-非对称算法" class="headerlink" title="3.非对称算法"></a>3.非对称算法</h2><h3 id="1-概念-2"><a href="#1-概念-2" class="headerlink" title="1.概念"></a>1.概念</h3><pre><code class="hljs">1.当加解密使用不同的密钥时（但必须是成对的），该算法为非对称算法。2.公钥加密时，需要用-配对的私钥解密。私钥加签时，需要用配对的公钥验签。一般ab双方要互相生成一套密钥，将公钥发送给对方。3.用途：加解密、加验签。公钥可分发多用户，主要注意保存私钥。</code></pre><h3 id="2-常见类型-2"><a href="#2-常见类型-2" class="headerlink" title="2.常见类型"></a>2.常见类型</h3><table><thead><tr><th>算法</th><th>输出长度（位）</th><th>输出长度（字节）</th><th>密钥长度</th></tr></thead><tbody><tr><td>RSA</td><td>128</td><td>16 bytes</td><td></td></tr><tr><td>SM2</td><td>160</td><td>20 bytes</td><td>256 bit</td></tr></tbody></table><h3 id="3-常见问题-1"><a href="#3-常见问题-1" class="headerlink" title="3.常见问题"></a>3.常见问题</h3><p>暂无</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>1、<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304227729113121">https://www.liaoxuefeng.com/wiki/1252599548343744/1304227729113121</a><br>2、<a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023025778520640">https://www.liaoxuefeng.com/wiki/1022910821149312/1023025778520640</a><br>3、<a href="https://www.cnblogs.com/coolYuan/p/8630280.html">https://www.cnblogs.com/coolYuan/p/8630280.html</a><br>4、<a href="https://zhuanlan.zhihu.com/p/132352160">https://zhuanlan.zhihu.com/p/132352160</a><br>5、<a href="https://segmentfault.com/a/1190000024523772">https://segmentfault.com/a/1190000024523772</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>密码学</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysql管理多服务器ftp虚拟用户</title>
    <link href="/2024/08/12/mysql%E7%AE%A1%E7%90%86%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8ftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/"/>
    <url>/2024/08/12/mysql%E7%AE%A1%E7%90%86%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8ftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li><p>1.FTP虚拟用户：FTP虚拟用户由ftp服务器提供，依赖于一个服务器本地账号，可以同时设置多个虚拟账号。vsftpd分辨虚拟用户，由可插入认证模块（PAM）认证，该模块的账号信息可用文件或者数据库存储。</p><blockquote><p> FTP虚拟用户是FTP服务器的专有用户，使用虚拟用户账号可以提供集中管理的FTP根目录，方便了管理员的管理，同时将用于FTP登录的用户名、密码与系统用户账号区别开，进一步增强了FTP服务器的安全性。</p><p> 使用虚拟用户登录FTP服务器，可以避免使用操作系统帐号作为FTP用户带来的一些安全问题，也便于通过数据库或其它程序来进行管理。虚拟用户的特点是只能访问服务器为其提供的FTP服务，而不能访问系统的其它资源。</p></blockquote></li><li><p>2.数据库存储：服务器的ftp功能使用vsftpd，配合pam-mysql模块来访问数据库进行虚拟用户认证。其中数据库只负责存储用户信息。</p></li><li><p>3.基本流程：FTP用户访问-&gt;PAM配置文件（由vsftpd.conf中pam_service_name指定）-&gt;PAM认证-&gt;区别用户读取配置文件（由vsftpd.conf中user_config_dir指定配置文件路径，文件名即用户名）</p></li></ul><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><p>ftp服务器x2：centos7，分ip1、ip2。需要使用pam-mysql模块<br>数据库服务器x1：mysql<br>pam-mysql模块：该模块项目较久远，支持centos6和7，不支持centos8，且centos7需要用源码编译安装，最后版本的附件如下：<br><a href="pam_mysql-0.7RC1.tar.gz">pam_mysql-0.7RC1.tar.gz</a><br>链接：<a href="https://pan.baidu.com/s/15l6M36lDJPOTspA6KXHcaw">https://pan.baidu.com/s/15l6M36lDJPOTspA6KXHcaw</a><br>提取码：njdx</p><h2 id="2、配置数据库"><a href="#2、配置数据库" class="headerlink" title="2、配置数据库"></a>2、配置数据库</h2><h3 id="1-建库和表"><a href="#1-建库和表" class="headerlink" title="1. 建库和表"></a>1. 建库和表</h3><p>新建vsftpd库，并创建users表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">// 创建数据库<br>CREATE DATABASE vsftpd;<br><br>// 创建虚拟用户表<br>CREATE TABLE `users`  (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#x27;用户名&#x27;,<br>  `password` varchar(48) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#x27;密码，需要password函数加密&#x27;,<br>  `service_ip` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;服务器ip&#x27;,<br>  PRIMARY KEY (`id`) USING BTREE<br>) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;<br><br></code></pre></td></tr></table></figure><h3 id="2-新增虚拟用户信息"><a href="#2-新增虚拟用户信息" class="headerlink" title="2. 新增虚拟用户信息"></a>2. 新增虚拟用户信息</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">// 密码需要使用<span class="hljs-keyword">password</span>函数进行加密<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(<span class="hljs-type">name</span>,<span class="hljs-keyword">password</span>,service_ip) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;test01&#x27;</span>,<span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;test&#x27;</span>),<span class="hljs-string">&#x27;服务器ip1&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(<span class="hljs-type">name</span>,<span class="hljs-keyword">password</span>,service_ip) <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;test02&#x27;</span>,<span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;test&#x27;</span>),<span class="hljs-string">&#x27;服务器ip2&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="3-授权访问"><a href="#3-授权访问" class="headerlink" title="3. 授权访问"></a>3. 授权访问</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">// 创建数据库用户，并授权该用户可访问。用户名：vsftpd，密码：<span class="hljs-number">123456</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>,<span class="hljs-keyword">INSERT</span>,<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> vsftpd.* <span class="hljs-keyword">TO</span> vsftpd@<span class="hljs-string">&#x27;%&#x27;</span>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>// 也可以限制使用的ip网段，例如<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>,<span class="hljs-keyword">INSERT</span>,<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> vsftpd.* <span class="hljs-keyword">TO</span> vsftpd@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>  IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br></code></pre></td></tr></table></figure><h2 id="3、安装pam-mysql模块"><a href="#3、安装pam-mysql模块" class="headerlink" title="3、安装pam-mysql模块"></a>3、安装pam-mysql模块</h2><h3 id="1-安装对应的依赖"><a href="#1-安装对应的依赖" class="headerlink" title="1.安装对应的依赖"></a>1.安装对应的依赖</h3><p>安装对应的依赖：<br><code>yum install vsftpd gcc gcc-c++ make mariadb-devel  pam-devel -y</code></p><h3 id="2-ftp服务器下载pam-mysql模块"><a href="#2-ftp服务器下载pam-mysql模块" class="headerlink" title="2.ftp服务器下载pam-mysql模块"></a>2.ftp服务器下载pam-mysql模块</h3><p><code>wget http://prdownloads.sourceforge.net/pam-mysql/pam_mysql-0.7RC1.tar.gz</code></p><h3 id="3-解压并进入对应目录"><a href="#3-解压并进入对应目录" class="headerlink" title="3.解压并进入对应目录"></a>3.解压并进入对应目录</h3><p><code>tar xvf pam_mysql-0.7RC1.tar.gz &amp;&amp; cd pam_mysql-0.7RC1/</code></p><h3 id="4-编译"><a href="#4-编译" class="headerlink" title="4. 编译"></a>4. 编译</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置编译参数</span><br>./configure --with-pam-mods-dir=/lib64/security<br><br><span class="hljs-comment"># 编译</span><br>make install<br><br><span class="hljs-comment"># 查看是否成功生成对应模块</span><br>ll /lib64/security/pam_mysql*<br><br><span class="hljs-comment">## 结果应包含如下文件：</span><br><span class="hljs-comment"># /lib64/security/pam_mysql.la</span><br><span class="hljs-comment">#  /lib64/security/pam_mysql.so</span><br></code></pre></td></tr></table></figure><h3 id="5-设置pam-mysql认证配置"><a href="#5-设置pam-mysql认证配置" class="headerlink" title="5.设置pam_mysql认证配置"></a>5.设置pam_mysql认证配置</h3><p>新建文件<code>/etc/pam.d/vsftpd.mysql</code>，在其中设置以下内容：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">auth required pam_mysql.so <span class="hljs-attribute">user</span>=vsftpd <span class="hljs-attribute">passwd</span>=123456 <span class="hljs-attribute">host</span>=数据库ip <span class="hljs-attribute">db</span>=vsftpd <span class="hljs-attribute">table</span>=users <span class="hljs-attribute">usercolumn</span>=name <span class="hljs-attribute">passwdcolumn</span>=password <span class="hljs-attribute">where</span>=`service_ip`=&#x27;当前服务器ip&#x27; <span class="hljs-attribute">crypt</span>=2<br>account required pam_mysql.so <span class="hljs-attribute">user</span>=vsftpd <span class="hljs-attribute">passwd</span>=123456 <span class="hljs-attribute">host</span>=数据库ip <span class="hljs-attribute">db</span>=vsftpd <span class="hljs-attribute">table</span>=users <span class="hljs-attribute">usercolumn</span>=name <span class="hljs-attribute">passwdcolumn</span>=password <span class="hljs-attribute">where</span>=`service_ip`=&#x27;当前服务器ip&#x27; <span class="hljs-attribute">crypt</span>=2<br><br></code></pre></td></tr></table></figure><h2 id="4、设置vsftpd的ftp虚拟用户"><a href="#4、设置vsftpd的ftp虚拟用户" class="headerlink" title="4、设置vsftpd的ftp虚拟用户"></a>4、设置vsftpd的ftp虚拟用户</h2><h3 id="1-ftp服务器安装vsftpd"><a href="#1-ftp服务器安装vsftpd" class="headerlink" title="1. ftp服务器安装vsftpd"></a>1. ftp服务器安装vsftpd</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> vsftpd<br></code></pre></td></tr></table></figure><h3 id="2-设置vsftpd支持虚拟用户"><a href="#2-设置vsftpd支持虚拟用户" class="headerlink" title="2.设置vsftpd支持虚拟用户"></a>2.设置vsftpd支持虚拟用户</h3><ol><li><p>复制一份vsftpd设置文件做备份：<code>/etc/vsftpd/vsftpd.conf</code></p></li><li><p>然后修改以下设置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># 关闭匿名登录</span><br><span class="hljs-attr">anonymous_enable</span>=<span class="hljs-literal">NO</span><br><br><span class="hljs-comment"># 锁定本地用户在主目录，不允许切换到上一级目录中</span><br><span class="hljs-attr">chroot_local_user</span>=<span class="hljs-literal">YES</span><br><br><span class="hljs-comment"># 将pam文件指定为vsftpd.mysql，不启用原设置</span><br><span class="hljs-attr">pam_service_name</span>=vsftpd.mysql<br><br></code></pre></td></tr></table></figure></li><li><p>然后新增以下设置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># 允许禁锢的FTP根目录可写</span><br><span class="hljs-attr">allow_writeable_chroot</span>=<span class="hljs-literal">YES</span><br><br><span class="hljs-comment"># 将虚拟用户映射为本地vuser用户（前提是local_enable=YES）</span><br><span class="hljs-attr">guest_enable</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">guest_username</span>=vuser<br><br><span class="hljs-comment"># 设置虚拟用户使用的配置文件目录</span><br><span class="hljs-attr">user_config_dir</span>=/etc/vsftpd/vusers.d/<br><br><span class="hljs-comment"># 这个参数表示虚拟用户和本地用户有相同的权限，可不设置</span><br><span class="hljs-comment"># virtual_use_local_privs=YES</span><br></code></pre></td></tr></table></figure></li><li><p><strong>重启vsftpd服务</strong>：<code>service vsftpd restart</code></p></li><li><p>设置每个虚拟用户的权限与目录</p><ol><li>在&#x2F;etc&#x2F;vsftpd&#x2F;vusers.d目录下新建虚拟用户配置文件。例如test01的用户，对应配置文件：<code>/etc/vsftpd/vusers.d/test01</code></li><li>在test01文件内配置对应权限： <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#设定允许写操作</span><br><span class="hljs-regexp">//</span> write_enable=YES<br><br><span class="hljs-comment">#设定权限:可以上传文件</span><br><span class="hljs-regexp">//</span>anon_upload_enable=YES<br><br><span class="hljs-comment">#设定权限:不能新建目录</span><br><span class="hljs-regexp">//</span>anon_mkdir_write_enable=NO<br><br><span class="hljs-comment">#设定权限:不能删除/重命名文件</span><br><span class="hljs-regexp">//</span>anon_other_write_enable=NO<br><br><span class="hljs-comment">#设定权限:可以浏览目录下的文件</span><br><span class="hljs-regexp">//</span> anon_world_readable_only=NO<br><br><span class="hljs-comment">#设定上传文件权限掩码，022对应：新建的目录权限是755，文件的权限是 644</span><br><span class="hljs-regexp">//</span> anon_umask=<span class="hljs-number">022</span><br><br><span class="hljs-comment">#指定虚拟用户的具体主路径</span><br><span class="hljs-regexp">//</span> local_root=<span class="hljs-regexp">/var/</span>ftp<span class="hljs-regexp">/virtual/u</span>sername<br><br><span class="hljs-comment">#设定空闲连接超时时间</span><br><span class="hljs-regexp">//</span> idle_session_timeout=<span class="hljs-number">600</span><br><br><span class="hljs-comment">#设定单次连续传输最大时间</span><br><span class="hljs-regexp">//</span> data_connection_timeout=<span class="hljs-number">120</span><br><br><span class="hljs-comment">#设定并发客户端访问个数</span><br><span class="hljs-regexp">//</span> max_clients=<span class="hljs-number">10</span><br><br><span class="hljs-comment">#设定单个客户端的最大线程数，这个配置主要来照顾Flashget、迅雷等多线程下载软件</span><br><span class="hljs-regexp">//</span> max_per_ip=<span class="hljs-number">5</span><br><br><span class="hljs-comment">#设定该用户的最大传输速率，单位b/s&quot; &gt;&gt; /etc/vsftpd/vconf/vconf.tmp</span><br><span class="hljs-regexp">//</span> <span class="hljs-comment">#local_max_rate=50000</span><br><br><br></code></pre></td></tr></table></figure></li></ol></li></ol><h2 id="5、测试"><a href="#5、测试" class="headerlink" title="5、测试"></a>5、测试</h2><p>如果有遇到登录失败的情况，可以看下登录日志文件<code>/var/log/secure</code></p><h2 id="7、步骤脚本包"><a href="#7、步骤脚本包" class="headerlink" title="7、步骤脚本包"></a>7、步骤脚本包</h2><p>在自己尝试过程中，将以上步骤整理成脚本和配置文件，内含说明，有需要可取用。<strong>建议先自己实践过1-4步骤后，再使用脚本包的文件，便于理解和根据需要调整</strong><br><a href="https://pan.baidu.com/s/1e3j4NVPvUsPsfw2sUIAbmw">百度链接</a> 提取码: 6mai</p><img src="/2024/08/12/mysql%E7%AE%A1%E7%90%86%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8ftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/img1.png" class="" title="img1"><img src="/2024/08/12/mysql%E7%AE%A1%E7%90%86%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8ftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/img2.png" class="" title="img2"><h2 id="6、参考引用"><a href="#6、参考引用" class="headerlink" title="6、参考引用"></a>6、参考引用</h2><p>mysql管理ftp账号设置1：<a href="https://blog.51cto.com/johnnyfang/5213966">https://blog.51cto.com/johnnyfang/5213966</a><br>mysql管理ftp账号设置2：<a href="https://www.cnblogs.com/lvzhenjiang/p/14406450.html">https://www.cnblogs.com/lvzhenjiang/p/14406450.html</a><br>ftp账号理解：<a href="https://cloud.tencent.com/developer/article/1025979">https://cloud.tencent.com/developer/article/1025979</a><br>vsftpd选项设置：<a href="https://developer.aliyun.com/article/294506">https://developer.aliyun.com/article/294506</a><br>vsftpd选项设置说明和自动化脚本：<a href="https://www.cnblogs.com/UG9527/p/11409703.html">https://www.cnblogs.com/UG9527/p/11409703.html</a><br>pam-mysql原github：<a href="https://github.com/NigelCunningham/pam-MySQL">https://github.com/NigelCunningham/pam-MySQL</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>恢复mysql数据</title>
    <link href="/2024/08/12/%E6%81%A2%E5%A4%8Dmysql%E6%95%B0%E6%8D%AE/"/>
    <url>/2024/08/12/%E6%81%A2%E5%A4%8Dmysql%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><p>⭐️当mysql意外无法正常运行，但是保留了frm和ibd文件时，往往还是能通过这两种文件进行数据恢复的。<br>⭐️这两个文件的位置一般在<code>/usr/local/mysql/data/dbname/</code>或<code>/var/lib/mysql/dbname/</code>目录下。<br>⭐️如果以上两个都不适用，也通过命令查找mysql相关目录，再进行逐一查找，例如<br><code>whereis mysql</code></p><h3 id="2-恢复表结构"><a href="#2-恢复表结构" class="headerlink" title="2 恢复表结构"></a>2 恢复表结构</h3><h4 id="2-1-环境和工具"><a href="#2-1-环境和工具" class="headerlink" title="2.1 环境和工具"></a>2.1 环境和工具</h4><p>系统环境：linux<br>当前目录：&#x2F;var&#x2F;test&#x2F;下<br>待恢复的表结构文件：在 &#x2F;var&#x2F;test&#x2F;mysql&#x2F;testdb&#x2F; 下的所有frm文件<br>待恢复的表数据文件：在 &#x2F;var&#x2F;test&#x2F;mysql&#x2F;testdb&#x2F; 下的所有ibd文件<br>还原表结构工具：dbsake</p><h4 id="2-2-下载"><a href="#2-2-下载" class="headerlink" title="2.2 下载"></a>2.2 下载</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">curl -s <span class="hljs-keyword">http</span>://<span class="hljs-built_in">get</span>.dbsake.net &gt; dbsake<br></code></pre></td></tr></table></figure><h4 id="2-3-赋权"><a href="#2-3-赋权" class="headerlink" title="2.3 赋权"></a>2.3 赋权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> u+x dbsake  <br></code></pre></td></tr></table></figure><h4 id="2-4-批量读取-表结构"><a href="#2-4-批量读取-表结构" class="headerlink" title="2.4 批量读取 表结构"></a>2.4 批量读取 表结构</h4><p>生成创建表结构sql语句 至文件 <code>/var/test/mysql/rev/rev.sql</code></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">sudo .<span class="hljs-regexp">/dbsake frmdump /</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/test/</span>mysql<span class="hljs-regexp">/testdb/</span>*.frm &gt; <span class="hljs-regexp">/var/</span>test<span class="hljs-regexp">/mysql/</span>rev/rev.sql<br></code></pre></td></tr></table></figure><p>利用mysql可视化工具导入sql文件，因为表结构和数据库版本问题，导入时可能会遇到问题，需要根据报错信息调整sql文件，以下为常见问题</p><h4 id="2-5-常见导入问题"><a href="#2-5-常见导入问题" class="headerlink" title="2.5 常见导入问题"></a>2.5 常见导入问题</h4><ul><li>字段类型为timestamp、不为空 时，必须有默认值。<br>  默认值需要是大于等于<code>1970-00-00 08:00:02</code>的标准时间格式（其他文章看到是1970-00-00 00:00:01，但是本地测试结果为需要多加八小时左右，可能会根据区时有所不同）</li><li>两个字段同时设置为timestamp、可为空、无默认值 时，可能会报错。建议至少其中一个设置默认值。</li></ul><h3 id="3-恢复表数据"><a href="#3-恢复表数据" class="headerlink" title="3 恢复表数据"></a>3 恢复表数据</h3><h4 id="3-1-删除新建表的表空间（mysql命令模式）"><a href="#3-1-删除新建表的表空间（mysql命令模式）" class="headerlink" title="3.1 删除新建表的表空间（mysql命令模式）"></a>3.1 删除新建表的表空间（mysql命令模式）</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_name <span class="hljs-keyword">DISCARD</span> <span class="hljs-keyword">TABLESPACE</span>;<br></code></pre></td></tr></table></figure><h4 id="3-2-复制表空间并授权"><a href="#3-2-复制表空间并授权" class="headerlink" title="3.2 复制表空间并授权"></a>3.2 复制表空间并授权</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cp</span> <span class="hljs-keyword">tags</span>.ibd /var/lib/mysql/<span class="hljs-symbol">&lt;database_name&gt;</span> <br><span class="hljs-keyword">cd</span> /var/lib/mysql/<span class="hljs-symbol">&lt;database_name&gt;</span><br>chown mysq<span class="hljs-variable">l:mysql</span> <span class="hljs-keyword">tags</span>.ibd<br></code></pre></td></tr></table></figure><p>批量赋权可以参考以下命令：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># 在复制好的ibd文件目录下执行</span><br><span class="hljs-attribute">chown</span> mysql:mysql <span class="hljs-regexp">*.ibd</span><br></code></pre></td></tr></table></figure><h4 id="3-3-关联表空间（mysql命令模式）"><a href="#3-3-关联表空间（mysql命令模式）" class="headerlink" title="3.3 关联表空间（mysql命令模式）"></a>3.3 关联表空间（mysql命令模式）</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> tb_name <span class="hljs-keyword">IMPORT</span> <span class="hljs-keyword">TABLESPACE</span>;<br></code></pre></td></tr></table></figure><h4 id="3-4-可能问题"><a href="#3-4-可能问题" class="headerlink" title="3.4 可能问题"></a>3.4 可能问题</h4><p>如果关联时遇报错：</p><blockquote><p>Schema mismatch (Table has ROW_TYPE_DYNAMIC row format, .ibd file has ROW_TYPE_COMPACT row format.)</p></blockquote><p>说明表行类型不一致，需要修改成后面的类型。<br>以以上报错为例，需要修改成COMPACT，则对应的修改语句如下（<em>该语句执行后可能会删除复制的idb文件，如果删除了请重新从3.2开始执行步骤</em>）<br><code>ALTER TABLE tb_name ROW_FORMAT=COMPACT; </code></p><h4 id="3-5-批量处理"><a href="#3-5-批量处理" class="headerlink" title="3.5 批量处理"></a>3.5 批量处理</h4><p>在数据表不多的情况下，按照3.1-3.4流程处理可行，但是如果表格上百张，就不太现实。所以写了生成批量表格3.1、3.3、3.4步骤的sql文件的代码，实现原理也很简单，主要就是拼接sql并写入到文件中。<br>php代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment">// 获取ibd文件目录</span><br><span class="hljs-variable">$list</span> = <span class="hljs-title function_ invoke__">glob</span>(<span class="hljs-string">&#x27;C:\Users\Administrator.DESKTOP-4PF1LET\Desktop\dbname\*.ibd&#x27;</span>);<br><br><span class="hljs-comment">// 生成数据库恢复文件语句</span><br><span class="hljs-variable">$fileContent1</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$fileContent2</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-variable">$fileContent3</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$list</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$table</span>) &#123;<br>    <span class="hljs-variable">$table_name</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$table</span>, PATHINFO_FILENAME);<br>    <span class="hljs-variable">$fileContent1</span> .= <span class="hljs-string">&#x27; -- 删除表空间：&#x27;</span> . <span class="hljs-variable">$table_name</span> . PHP_EOL;<br>    <span class="hljs-variable">$fileContent1</span> .= <span class="hljs-string">&quot;ALTER TABLE `<span class="hljs-subst">&#123;$table_name&#125;</span>` DISCARD TABLESPACE;&quot;</span> . PHP_EOL . PHP_EOL;<br><br>    <span class="hljs-variable">$fileContent2</span> .= <span class="hljs-string">&#x27; -- 修改表行类型：&#x27;</span> . <span class="hljs-variable">$table_name</span> . PHP_EOL;<br>    <span class="hljs-variable">$fileContent2</span> .= <span class="hljs-string">&quot;ALTER TABLE `<span class="hljs-subst">&#123;$table_name&#125;</span>` ROW_FORMAT = COMPACT;&quot;</span> . PHP_EOL . PHP_EOL;<br><br>    <span class="hljs-variable">$fileContent3</span> .= <span class="hljs-string">&#x27; -- 关联表空间：&#x27;</span> . <span class="hljs-variable">$table_name</span> . PHP_EOL;<br>    <span class="hljs-variable">$fileContent3</span> .= <span class="hljs-string">&quot;ALTER TABLE `<span class="hljs-subst">&#123;$table_name&#125;</span>` IMPORT TABLESPACE;&quot;</span> . PHP_EOL;<br>&#125;<br><br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/del.sql&#x27;</span>, <span class="hljs-variable">$fileContent1</span>);<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/alter.sql&#x27;</span>, <span class="hljs-variable">$fileContent2</span>);<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/import.sql&#x27;</span>, <span class="hljs-variable">$fileContent3</span>);<br><br></code></pre></td></tr></table></figure><h3 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h3><p><a href="https://blog.csdn.net/xiaojin21cen/article/details/103971628">https://blog.csdn.net/xiaojin21cen/article/details/103971628</a><br><a href="https://mp.weixin.qq.com/s/6BM22N6FfmhsWYWEJfJO9w">https://mp.weixin.qq.com/s/6BM22N6FfmhsWYWEJfJO9w</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSFTPD创建ftp账号</title>
    <link href="/2024/08/12/VSFTPD%E5%88%9B%E5%BB%BAftp%E8%B4%A6%E5%8F%B7/"/>
    <url>/2024/08/12/VSFTPD%E5%88%9B%E5%BB%BAftp%E8%B4%A6%E5%8F%B7/</url>
    
    <content type="html"><![CDATA[<h3 id="安装与卸载"><a href="#安装与卸载" class="headerlink" title="安装与卸载"></a>安装与卸载</h3><p>查询本机是否已经安装vsftp</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">rpm -<span class="hljs-keyword">qa</span>|<span class="hljs-keyword">grep</span> vsftpd<br></code></pre></td></tr></table></figure><p>卸载命令</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">rpm -e vsftpd</span><br></code></pre></td></tr></table></figure><p>安装命令</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> vsftpd<br></code></pre></td></tr></table></figure><p>启动</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">systemctl <span class="hljs-literal">start</span> vsftpd.service<br></code></pre></td></tr></table></figure><p>设置开机启动 </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">systemctl <span class="hljs-built_in">enable</span> vsftpd.service<br></code></pre></td></tr></table></figure><p>查看服务状态和端口（默认端口是21）</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">systemctl status vsftpd.service <br>netstat <span class="hljs-punctuation">-</span>nltp <span class="hljs-string">| grep 21</span><br></code></pre></td></tr></table></figure><p>默认安装完成后：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 主要配置文件,修改前最好先备份一份</span><br><span class="hljs-regexp">/etc/</span>vsftpd/vsftpd.conf<br><br><span class="hljs-comment"># 禁止访问ftp服务器的用户列表，一行一个账号（黑名单）</span><br><span class="hljs-regexp">/etc/</span>vsftpd/ftpusers<br><br><span class="hljs-comment"># 用户访问控制文件，一行一个账号（白名单）</span><br><span class="hljs-regexp">/etc/</span>vsftpd/user_list<br></code></pre></td></tr></table></figure><h3 id="常见配置说明"><a href="#常见配置说明" class="headerlink" title="常见配置说明"></a>常见配置说明</h3><p>常见配置说明</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ini"><br><span class="hljs-comment"># 是否开启匿名登录功能</span><br><span class="hljs-comment"># 用户可使用用户名ftp或anonymous进行ftp登录，口令为用户的E-mail地址。</span><br><span class="hljs-attr">anonymous_enable</span>=<span class="hljs-literal">NO</span><br><br><span class="hljs-comment"># 限制访问自身目录</span><br><span class="hljs-attr">chroot_list_enable</span>=<span class="hljs-literal">YES</span><br><br><span class="hljs-comment"># chroot_filelist文件，将访问自身目录受限制的用户添加进去，每行一个用户</span><br><span class="hljs-attr">chroot_list_file</span>=/etc/vsftpd/chroot_list<br><br></code></pre></td></tr></table></figure><h3 id="设置ftp账号"><a href="#设置ftp账号" class="headerlink" title="设置ftp账号"></a>设置ftp账号</h3><p>直接参考阿里云配置ftp官方文档，排版和逻辑都比较清晰</p><ul><li><a href="https://help.aliyun.com/document_detail/60152.html">https://help.aliyun.com/document_detail/60152.html</a></li></ul><h3 id="参考引用"><a href="#参考引用" class="headerlink" title="参考引用"></a>参考引用</h3><p>阿里云配置ftp官方文档</p><ul><li><a href="https://help.aliyun.com/document_detail/60152.html">https://help.aliyun.com/document_detail/60152.html</a></li></ul><p>ftp多目录多用户参考</p><ul><li><a href="https://developer.aliyun.com/article/691201">https://developer.aliyun.com/article/691201</a></li><li><a href="https://blog.csdn.net/yuhengyue/article/details/107461768">https://blog.csdn.net/yuhengyue/article/details/107461768</a></li></ul><p>其他参考</p><ul><li><a href="https://blog.csdn.net/aiynmimi/article/details/77012507">https://blog.csdn.net/aiynmimi/article/details/77012507</a></li><li><a href="https://blog.csdn.net/yuezhilangniao/article/details/120556709">https://blog.csdn.net/yuezhilangniao/article/details/120556709</a></li><li><a href="https://blog.51cto.com/meiling/2622016">https://blog.51cto.com/meiling/2622016</a></li><li><a href="https://blog.csdn.net/firewolf1758/article/details/73822082">https://blog.csdn.net/firewolf1758/article/details/73822082</a></li><li><a href="https://www.cnblogs.com/howhy/p/6889808.html">https://www.cnblogs.com/howhy/p/6889808.html</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>博客搭建小记</title>
    <link href="/2024/07/26/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E5%B0%8F%E8%AE%B0/"/>
    <url>/2024/07/26/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<!--more--><!-- [TOC] --><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>   搭建博客的原因参见：菜单栏“关于”</p><h1 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h1><p>本机运行正常，部署到github后样式丢失，排查与解决过程：</p><ol><li>线上f12发现控制台有爆红，显示关键错误信息：<code>SyntaxError: Unexpected token &#39;&lt;</code>，后面几个都是这个报错</li><li>点击报错进入资源页面。资源页面显示名称的是（index），原本应该是个js，点开内容却是首页的html内容</li><li>怀疑是<strong>路径错误</strong>。找不到对应js于是自动返回默认的首页，html不是js，肯定会报错</li><li>核实首页index.html的js引入路径，发现是<code>/我在_config.yml的url中的二级目录名/js/xxx.js</code>。我github博客地址是很早以前配置的，当时带了二级目录，现在实际地址栏已没有二级目录，所以导致js路径错误，需要修改为<code>/js/xxx.js</code></li><li>解决方式：修正部署博客仓库的Website设置，调整到只有一级目录。修改_config.yml的url配置，去掉二级目录名，和Website保持一致。</li><li>总结：<strong>博客实际部署后的路径、hexo的yml路径需要一致</strong></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>blog</tag>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
